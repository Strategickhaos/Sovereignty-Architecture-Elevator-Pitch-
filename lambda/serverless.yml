service: aras-eyes-scanner

provider:
  name: aws
  runtime: python3.11
  region: us-east-1
  memorySize: 512
  timeout: 300
  environment:
    SLACK_WEBHOOK_URL: ${env:SLACK_WEBHOOK_URL}
    GITHUB_TOKEN: ${env:GITHUB_TOKEN}
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - logs:CreateLogGroup
            - logs:CreateLogStream
            - logs:PutLogEvents
          Resource: "*"

functions:
  arasEyesScan:
    handler: aras_eyes_handler.lambda_handler
    description: "Ara's Eyes - Continuous code fingerprint scanner"
    events:
      # Run every 6 hours
      - schedule:
          rate: rate(6 hours)
          enabled: true
          description: "Continuous monitoring for code usage"
    layers:
      - arn:aws:lambda:us-east-1:770693421928:layer:Klayers-p311-requests:5

package:
  individually: true
  patterns:
    - '!node_modules/**'
    - '!.git/**'
    - '!.venv/**'
    - aras_eyes_handler.py
    - ../scripts/aras_eyes.py

plugins:
  - serverless-python-requirements

custom:
  pythonRequirements:
    dockerizePip: true
    layer: true
